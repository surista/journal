<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Guitar Practice Journal - Mobile Test</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- Add test parameter to enable mobile improvements -->
    <script>
        // This flag enables mobile-specific improvements for testing
        window.MOBILE_TEST_MODE = true;
        
        // Add mobile device detection
        window.isMobileDevice = () => {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            return /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent.toLowerCase()) ||
                   (window.innerWidth <= 768);
        };
        
        // Add viewport size logger
        window.logViewportSize = () => {
            console.log(`Viewport: ${window.innerWidth}x${window.innerHeight}`);
            console.log(`Device Pixel Ratio: ${window.devicePixelRatio}`);
            console.log(`Is Mobile: ${window.isMobileDevice()}`);
        };
        
        window.addEventListener('load', window.logViewportSize);
        window.addEventListener('resize', window.logViewportSize);
    </script>
    
    <!-- Load existing styles -->
    <link rel="stylesheet" href="./styles/loading.css">
    <link rel="stylesheet" href="./styles/main.css">
    
    <!-- Mobile-specific test styles -->
    <style>
        /* Mobile Test Mode Indicator */
        body.mobile-test-mode::before {
            content: "MOBILE TEST MODE";
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            background: #ff6b6b;
            color: white;
            padding: 2px 10px;
            font-size: 10px;
            z-index: 10000;
            border-radius: 0 0 4px 4px;
        }
        
        /* Enhanced Mobile Styles for Testing */
        @media (max-width: 768px) {
            /* Improve touch targets */
            button, .btn, .nav-item, .tab-button {
                min-height: 44px !important;
                min-width: 44px !important;
                padding: 12px 16px !important;
            }
            
            /* Better spacing */
            .container, .dashboard-container {
                padding: 0 !important;
            }
            
            /* Improve readability */
            body {
                font-size: 16px !important;
                -webkit-text-size-adjust: 100%;
            }
            
            /* Fix overflow issues */
            * {
                max-width: 100vw !important;
                overflow-x: hidden;
            }
            
            /* Bottom navigation for mobile */
            .mobile-bottom-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: var(--bg-secondary);
                border-top: 1px solid var(--border);
                display: flex;
                justify-content: space-around;
                padding: 8px 0;
                z-index: 1000;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            }
            
            /* Adjust content for bottom nav */
            .dashboard-container {
                padding-bottom: 60px !important;
            }
            
            /* Improve form inputs */
            input, select, textarea {
                font-size: 16px !important;
                padding: 12px !important;
                border-radius: 8px !important;
            }
            
            /* Better modal handling */
            .modal {
                margin: 10px !important;
                max-height: calc(100vh - 20px) !important;
                overflow-y: auto !important;
            }
            
            /* Improve cards */
            .card {
                margin: 10px !important;
                border-radius: 12px !important;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
            }
        }
        
        /* iPhone X and newer safe areas */
        @supports (padding: max(0px)) {
            .dashboard-container {
                padding-bottom: max(60px, env(safe-area-inset-bottom)) !important;
            }
            
            .mobile-bottom-nav {
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>
<body class="mobile-test-mode">
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-container">
            <h1 class="loading-title">üé∏ Guitar Practice Journal</h1>
            <p class="loading-subtitle">Mobile Test Version</p>
            <div class="loading-spinner"></div>
            <p class="loading-status">Loading application...</p>
        </div>
    </div>

    <div id="app"></div>
    
    <!-- Mobile bottom navigation (for testing) -->
    <div class="mobile-bottom-nav" style="display: none;">
        <button class="nav-button" onclick="navigateTo('practice')">
            <span>üéµ</span>
            <span>Practice</span>
        </button>
        <button class="nav-button" onclick="navigateTo('audio')">
            <span>üéß</span>
            <span>Audio</span>
        </button>
        <button class="nav-button" onclick="navigateTo('stats')">
            <span>üìä</span>
            <span>Stats</span>
        </button>
        <button class="nav-button" onclick="navigateTo('settings')">
            <span>‚öôÔ∏è</span>
            <span>Settings</span>
        </button>
    </div>

    <!-- Load the main app with mobile flag -->
    <script type="module">
        import { App } from './src/app.js';
        
        // Initialize app with mobile test mode
        const app = new App();
        
        // Add mobile-specific initialization
        if (window.isMobileDevice()) {
            document.body.classList.add('is-mobile-device');
            document.querySelector('.mobile-bottom-nav').style.display = 'flex';
        }
        
        // Navigation helper for mobile testing
        window.navigateTo = (section) => {
            console.log(`Mobile navigation to: ${section}`);
            // Add navigation logic here
        };
        
        app.init().catch(error => {
            console.error('Failed to initialize app:', error);
            document.getElementById('loading-overlay').innerHTML = `
                <div class="loading-container">
                    <h1>‚ö†Ô∏è Error</h1>
                    <p>${error.message}</p>
                    <button onclick="location.reload()">Reload</button>
                </div>
            `;
        });
    </script>
</body>
</html>